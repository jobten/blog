{"version":3,"file":"pages/login.js","sources":["webpack:///./pages/login.vue?b32b","webpack:///./pages/login.vue","webpack:///./pages/login.vue?84b7","webpack:///./pages/login.vue?120f"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login-container\"},[_c('el-form',{ref:\"loginForm\",staticClass:\"login-form\",attrs:{\"label-width\":\"100px\",\"model\":_vm.form,\"rules\":_vm.rules}},[_c('div',{staticClass:\"title-container\"},[_c('img',{attrs:{\"src\":\"/logo.png\",\"alt\":\"\"}})]),_vm._v(\" \"),_c('el-form-item',{attrs:{\"prop\":\"email\",\"label\":\"邮箱\"}},[_c('el-input',{attrs:{\"placeholder\":\"请输入邮箱\"},model:{value:(_vm.form.email),callback:function ($$v) {_vm.$set(_vm.form, \"email\", $$v)},expression:\"form.email\"}})],1),_vm._v(\" \"),_c('el-form-item',{staticClass:\"captcha-container\",attrs:{\"prop\":\"captcha\",\"label\":\"图片验证码\"}},[_c('div',{staticClass:\"captcha\"},[_c('img',{attrs:{\"src\":_vm.code.captcha},on:{\"click\":_vm.resetCaptcha}})]),_vm._v(\" \"),_c('el-input',{attrs:{\"placeholder\":\"请输入验证码\"},model:{value:(_vm.form.captcha),callback:function ($$v) {_vm.$set(_vm.form, \"captcha\", $$v)},expression:\"form.captcha\"}})],1),_vm._v(\" \"),_c('el-form-item',{staticClass:\"captcha-container\",attrs:{\"prop\":\"emailcode\",\"label\":\"邮箱验证码\"}},[_c('div',{staticClass:\"captcha\"},[_c('el-button',{attrs:{\"disabled\":_vm.send.timer>0,\"type\":\"primary\"},on:{\"click\":_vm.sendEmailCode}},[_vm._v(_vm._s(_vm.sendText))])],1),_vm._v(\" \"),_c('el-input',{attrs:{\"placeholder\":\"请输入邮件验证码\"},model:{value:(_vm.form.emailcode),callback:function ($$v) {_vm.$set(_vm.form, \"emailcode\", $$v)},expression:\"form.emailcode\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"prop\":\"passwd\",\"label\":\"密码\"}},[_c('el-input',{attrs:{\"type\":\"password\",\"placeholder\":\"请输入密码\"},model:{value:(_vm.form.passwd),callback:function ($$v) {_vm.$set(_vm.form, \"passwd\", $$v)},expression:\"form.passwd\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\" \"}},[_c('el-button',{attrs:{\"type\":\"primary\"},nativeOn:{\"click\":function($event){$event.preventDefault();return _vm.handleLogin($event)}}},[_vm._v(\"登录\")]),_vm._v(\" \"),_c('nuxt-link',{attrs:{\"to\":\"/register\"}},[_c('el-button',{attrs:{\"type\":\"primary\"}},[_vm._v(\"注册\")])],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport md5 from 'md5'\nexport default {\n  layout:'login',\n  methods:{\n    async sendEmailCode(){\n      // @todo\n      await this.$http.get('/sendcode?email='+this.form.email)\n      this.send.timer = 10\n      this.timer = setInterval(()=>{\n        this.send.timer -= 1\n        if(this.send.timer===0){\n          clearInterval(this.timer)\n        }\n      },1000)\n    },\n    resetCaptcha(){\n      this.code.captcha = '/api/captcha?_t'+new Date().getTime()\n    },\n    handleLogin(){\n      this.$refs.loginForm.validate( async valid=>{\n        if(valid){\n          // @todo 发送注册请求\n          let obj = {\n            email:this.form.email,\n            passwd:md5(this.form.passwd),\n            captcha:this.form.captcha,\n            emailcode:this.form.emailcode\n          }\n          let ret = await this.$http.post('/user/login',obj)\n          // code=0 就是成功\n          console.log(ret)\n          if(ret.code==0){\n            // ttoken的存储 登录成功，返回token\n            this.$message.success('登录成功')\n            localStorage.setItem('KKB_USER_TOKEN',ret.data.token)\n            setTimeout(()=>{\n                this.$router.push(\"/\")\n            },500)\n\n          }else{\n            this.$message.error(ret.message)\n          }\n        }else{\n          console.log('校验失败')\n        }\n      })\n    }\n  },\n  computed:{\n    sendText(){\n      if(this.send.timer<=0){\n        return '发送'\n      }\n      return `${this.send.timer}s后发送`\n    }\n  },\n  data(){\n    return {\n      send:{\n        timer:0\n      },\n      form:{\n        email:\"1017665401@qq.com\",\n        passwd:\"123456\",\n        captcha:\"\"\n      },\n      rules:{\n        email:[\n          { required:true, message:\"请输入邮箱\" },\n          { type:'email', message:\"请输入正确的邮箱格式\" },\n        ],\n        captcha:[\n          { required:true, message:\"请输入验证码\" },\n        ],\n        emailcode:[\n          { required:true, message:\"请输入邮箱验证码\" },\n        ],\n\n        passwd:[\n          { required:true, pattern:/^[\\w_-]{6,12}$/g, message:\"请输入6~12位密码\" },\n        ]  \n      },\n      code:{\n        captcha:\"/api/captcha\"\n      }\n    }\n  }\n}\n","import mod from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./login.vue?vue&type=template&id=719ba5f9&\"\nimport script from \"./login.vue?vue&type=script&lang=js&\"\nexport * from \"./login.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"1c43da96\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5CA;AA6CA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAPA;AACA;AAOA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAbA;AAgBA;AACA;AADA;AAzBA;AA6BA;AACA;AAtFA;;ACjDA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}